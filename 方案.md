# Fix Plan: run_sub_agent live process in chat tool tag

## Symptom
- While run_sub_agent is executing, the tool tag popover/drawer does not show live steps.
- Steps only appear after the tool result arrives.

## Root Cause
- run_sub_agent uses start_sub_agent_async + polling, but the async worker never emitted progress events, so no notifications reached the UI.
- registerMcpNotificationHandlers built the notifications/progress schema with Zod v3 while NotificationSchema is Zod v4, causing parse errors that dropped notifications silently.
- In the UI, liveSteps is derived inside a memo that did not depend on subagentStreams, so even when streams update the UI did not re-render the tool tag content.

## Fix
1. Propagate tool call meta (_meta) when starting async sub-agent jobs so notifications can carry sessionId/toolCallId.
2. Add IPC progress forwarding: worker sends progress payloads to parent; parent relays them via createSubagentProgressEmitter.
3. Build notifications/progress schema with Zod v4 to avoid parse errors and ensure MCP notifications reach the UI.
4. Update AssistantTurnCard memo dependency to include subagentStreams so live steps re-render in real time.
5. Add event log entries for async start/progress to aid debugging.

## Validation
- Start a run_sub_agent call and open the tool tag popover/drawer; steps should append live.
- Check event log for subagent_async_start and subagent_async_progress entries while the job runs.
- Check event log for mcp_stream entries with method notifications/progress for the same run.
- Confirm final tool result still appears when the job completes.

## Notes
- If the UI still does not update, confirm notifications/progress contains toolCallId and sessionId.
